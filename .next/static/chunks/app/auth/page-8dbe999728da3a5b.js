(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[235],{913:function(e,t,r){Promise.resolve().then(r.bind(r,7116))},7116:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return d}});var s=r(7437),a=r(2265),n=r(1021),o=r(3511),i=r(9937),l=r(277);function c(e){let{onOtpSent:t}=e,[r,c]=(0,a.useState)(""),[h,u]=(0,a.useState)(!1),p=(0,a.useRef)(null);(0,a.useEffect)(()=>{var e;null===(e=p.current)||void 0===e||e.focus()},[]);let d=async()=>{if(!/^09\d{9}$/.test(r)){n.ZP.error("شماره موبایل معتبر نیست");return}u(!0);try{let e=await l.Z.createOtp({mobile:r});console.log(e),(null==e?void 0:e.isSuccess)?(n.ZP.success("کد ارسال شد"),t(r)):n.ZP.error(e.message||"ارسال کد ناموفق بود")}catch(e){n.ZP.error("خطا در ارتباط با سرور")}finally{u(!1)}};return(0,s.jsxs)("div",{className:"space-y-6 w-full max-w-md mx-auto rounded-xl  bg-white",children:[(0,s.jsx)("div",{className:"text-center text-lg font-semibold text-gray-700",children:"ورود با شماره موبایل"}),(0,s.jsx)(o.default,{ref:p,size:"large",placeholder:"مثلاً: 09123456789",value:r,onChange:e=>c(e.target.value),className:"text-right",inputMode:"numeric",maxLength:11}),(0,s.jsx)(i.ZP,{type:"primary",block:!0,className:"h-12 rounded-lg text-base full px-6 py-3 bg-blue-600 text-white hover:bg-blue-700 transition",loading:h,onClick:d,children:"ارسال کد"})]})}var h=r(9376),u=r(605);function p(e){let{mobile:t}=e,[r,l]=(0,a.useState)(["","","","",""]),[c,p]=(0,a.useState)(!1),d=(0,h.useRouter)(),f=(0,a.useRef)([]);(0,a.useEffect)(()=>{var e;null===(e=f.current[0])||void 0===e||e.focus()},[]);let m=(e,t)=>{if(/^\d?$/.test(t)){let a=[...r];if(a[e]=t,l(a),t&&e<r.length-1){var s;null===(s=f.current[e+1])||void 0===s||s.focus()}}},y=(e,t)=>{if("Backspace"===t.key&&!r[e]&&e>0){var s;null===(s=f.current[e-1])||void 0===s||s.focus()}},v=async()=>{let e=r.join("");if(e.length<5){n.ZP.error("کد ناقص است");return}p(!0);try{console.log(e,t);let r=await (0,u.signIn)("credentials",{redirect:!1,mobile:t,code:e});if(console.log("REDDDD",null==r?void 0:r.ok),null==r?void 0:r.ok){var s;await new Promise(e=>setTimeout(e,500));let e=await (0,u.getSession)();(null==e?void 0:null===(s=e.user)||void 0===s?void 0:s.accessToken)?(n.ZP.success("ورود موفق"),d.replace("/dashboard")):n.ZP.error("خطا در دریافت سشن"),n.ZP.success("ورود موفق"),d.replace("/dashboard")}else n.ZP.error("کد اشتباه است یا مشکلی رخ داده")}catch(e){n.ZP.error("خطا در ارتباط با سرور")}finally{p(!1)}};return(0,s.jsxs)("div",{className:"space-y-6",dir:"ltr",children:[(0,s.jsx)("div",{className:"flex flex-row justify-center gap-2",children:r.map((e,t)=>(0,s.jsx)(o.default,{ref:e=>f.current[t]=e,maxLength:1,value:e,onChange:e=>m(t,e.target.value),onKeyDown:e=>y(t,e),className:"w-12 h-12 text-center text-xl",inputMode:"numeric"},t))}),(0,s.jsx)(i.ZP,{type:"primary",block:!0,className:"h-12 rounded-lg text-base full px-6 py-3 bg-blue-600 text-white hover:bg-blue-700 transition",loading:c,onClick:v,children:"تأیید"})]})}function d(){let[e,t]=(0,a.useState)("");return(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 px-4",children:(0,s.jsxs)("div",{className:"bg-white shadow-md rounded-2xl p-8 w-full max-w-md",children:[(0,s.jsx)("h2",{className:"text-2xl font-semibold mb-6 text-center text-gray-700",children:"ورود / ثبت‌نام"}),e?(0,s.jsx)(p,{mobile:e}):(0,s.jsx)(c,{onOtpSent:t})]})})}},277:function(e,t,r){"use strict";r.d(t,{y:function(){return o},Z:function(){return i}});var s=r(3464);class a{createOtp(e,t){let r=this.baseUrl+"/api/auth/create-otp";r=r.replace(/[?&]$/,"");let s={data:JSON.stringify(e),method:"POST",url:r,headers:{"Content-Type":"application/json",Accept:"application/json"},cancelToken:t};return this.instance.request(s).catch(e=>{if(n(e)&&e.response)return e.response;throw e}).then(e=>this.processCreateOtp(e))}processCreateOtp(e){e.status;let t={};if(e.headers&&"object"==typeof e.headers)for(let r in e.headers)e.headers.hasOwnProperty(r)&&(t[r]=e.headers[r]);{let t=e.data;return Promise.resolve(JSON.parse(t))}}checkOtp(e,t){let r=this.baseUrl+"/api/auth/check-otp";r=r.replace(/[?&]$/,"");let s={data:JSON.stringify(e),method:"POST",url:r,headers:{"Content-Type":"application/json",Accept:"application/json"},cancelToken:t};return this.instance.request(s).catch(e=>{if(n(e)&&e.response)return e.response;throw e}).then(e=>this.processCheckOtp(e))}processCheckOtp(e){e.status;let t={};if(e.headers&&"object"==typeof e.headers)for(let r in e.headers)e.headers.hasOwnProperty(r)&&(t[r]=e.headers[r]);{let t=e.data;return Promise.resolve(JSON.parse(t))}}createChat(e){let t=this.baseUrl+"/api/ai/create-chat",r={method:"POST",url:t=t.replace(/[?&]$/,""),headers:{Accept:"application/json"},cancelToken:e};return this.instance.request(r).catch(e=>{if(n(e)&&e.response)return e.response;throw e}).then(e=>this.processCreateChat(e))}processCreateChat(e){e.status;let t={};if(e.headers&&"object"==typeof e.headers)for(let r in e.headers)e.headers.hasOwnProperty(r)&&(t[r]=e.headers[r]);{let t=e.data;return Promise.resolve(JSON.parse(t))}}chat(e,t){let r=this.baseUrl+"/api/ai/chat";r=r.replace(/[?&]$/,"");let s={data:JSON.stringify(e),method:"POST",url:r,headers:{"Content-Type":"application/json",Accept:"application/json"},cancelToken:t};return this.instance.request(s).catch(e=>{if(n(e)&&e.response)return e.response;throw e}).then(e=>this.processChat(e))}processChat(e){e.status;let t={};if(e.headers&&"object"==typeof e.headers)for(let r in e.headers)e.headers.hasOwnProperty(r)&&(t[r]=e.headers[r]);{let t=e.data;return Promise.resolve(JSON.parse(t))}}createPayment(e,t){let r=this.baseUrl+"/api/payment/create-payment";r=r.replace(/[?&]$/,"");let s={data:JSON.stringify(e),method:"POST",url:r,headers:{"Content-Type":"application/json",Accept:"application/json"},cancelToken:t};return this.instance.request(s).catch(e=>{if(n(e)&&e.response)return e.response;throw e}).then(e=>this.processCreatePayment(e))}processCreatePayment(e){e.status;let t={};if(e.headers&&"object"==typeof e.headers)for(let r in e.headers)e.headers.hasOwnProperty(r)&&(t[r]=e.headers[r]);{let t=e.data;return Promise.resolve(JSON.parse(t))}}verifyPayment(e,t,r){let s=this.baseUrl+"/api/payment/verify-payment?";if(null==e)throw Error("The parameter 'authority' must be defined and cannot be null.");if(s+="authority="+encodeURIComponent(""+e)+"&",null==t)throw Error("The parameter 'status' must be defined and cannot be null.");s+="status="+encodeURIComponent(""+t)+"&";let a={method:"GET",url:s=s.replace(/[?&]$/,""),headers:{Accept:"application/json"},cancelToken:r};return this.instance.request(a).catch(e=>{if(n(e)&&e.response)return e.response;throw e}).then(e=>this.processVerifyPayment(e))}processVerifyPayment(e){e.status;let t={};if(e.headers&&"object"==typeof e.headers)for(let r in e.headers)e.headers.hasOwnProperty(r)&&(t[r]=e.headers[r]);{let t=e.data;return Promise.resolve(JSON.parse(t))}}constructor(e,t){this.jsonParseReviver=void 0,this.instance=t||s.Z.create(),this.baseUrl=null!=e?e:"/"}}function n(e){return e&&!0===e.isAxiosError}let o=s.Z.create({baseURL:"http://localhost:3001",headers:{Authorization:void 0},transformResponse:e=>e});o.interceptors.response.use(e=>e,async e=>(e.response&&401===e.response.status&&console.log("mosys2",e),Promise.reject(e)));var i=new a(o.defaults.baseURL,o)}},function(e){e.O(0,[79,325,511,832,971,117,744],function(){return e(e.s=913)}),_N_E=e.O()}]);